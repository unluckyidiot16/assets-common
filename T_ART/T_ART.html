<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNS í† ë¡  ë°°í‹€ (T-ARA)</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Noto Sans KR í°íŠ¸ ìš°ì„  ì ìš© */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            min-height: 100vh;
            overscroll-behavior-y: contain;
        }

        /* AI ë§í’ì„  ê¼¬ë¦¬ */
        .speech-bubble {
            position: relative;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20px;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: #e5e7eb; /* bg-gray-200 */
            border-bottom: 0;
            margin-bottom: -15px;
        }

        /* ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* ì¹´ë“œê°€ ì„ íƒ ìŠ¬ë¡¯ì— ìˆì„ ë•Œ (í´ë¦­ ë¹„í™œì„±í™”) */
        .card-in-slot {
            cursor: default;
            pointer-events: none;
        }
        .card-in-slot:hover {
            transform: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* ì¹´ë“œ ë¹„í™œì„±í™” (íŒíŠ¸ ì‚¬ìš© ì‹œ) */
        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* ì •ì‹ ë ¥ í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        .heart-beat {
            animation: heartBeat 1.2s infinite ease-in-out;
        }
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .heart-empty {
            color: #d1d5db; /* gray-400 */
            animation: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen overflow-y-auto">

<div id="game-container" class="container mx-auto p-2 sm:p-4 max-w-4xl h-full flex flex-col">

    <!-- === ì‹œì‘ í™”ë©´ === -->
    <div id="start-screen" class="flex flex-col items-center justify-center text-center bg-white rounded-lg shadow-xl p-6 sm:p-8 my-auto">
        <h1 class="text-3xl sm:text-4xl font-bold text-indigo-600 mb-4">T-ARA í† ë¡  ë°°í‹€</h1>
        <p class="text-base sm:text-lg text-gray-700 mb-2">Tiki-Taka Argument</p>
        <div class="bg-gray-100 rounded-lg p-4 sm:p-6 my-4 sm:my-6 w-full">
            <h2 class="text-xl sm:text-2xl font-bold mb-3">í† ë¡  ì£¼ì œ</h2>
            <p class="text-lg sm:text-xl text-gray-800">"SNS ì‚¬ìš©ì„ ì œí•œí•´ì•¼ í•œë‹¤ (ì—°ë ¹/ì‹œê°„ ì œí•œ í¬í•¨)"</p>
        </div>
        <p class="text-base sm:text-lg text-gray-600 mb-8">ë‹¹ì‹ ì˜ ì…ì¥ì„ ì„ íƒí•˜ì„¸ìš”.</p>
        <div class="flex flex-col sm:flex-row gap-4 w-full">
            <button id="start-pro" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 sm:py-4 px-6 rounded-lg text-base sm:text-lg transition-colors shadow-lg">
                [ì°¬ì„±] ì¸¡ìœ¼ë¡œ ì‹œì‘<br>
                <span class="text-sm font-normal">(AIëŠ” ë°˜ëŒ€ ì¸¡)</span>
            </button>
            <button id="start-con" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 sm:py-4 px-6 rounded-lg text-base sm:text-lg transition-colors shadow-lg">
                [ë°˜ëŒ€] ì¸¡ìœ¼ë¡œ ì‹œì‘<br>
                <span class="text-sm font-normal">(AIëŠ” ì°¬ì„± ì¸¡)</span>
            </button>
        </div>
    </div>

    <!-- === ê²Œì„ í™”ë©´ (ìˆ¨ê¹€) === -->
    <div id="game-screen" class="hidden flex-col flex-1 min-h-0">
        <!-- 1. ìƒíƒœ í‘œì‹œì¤„ -->
        <div id="status-bar" class="flex items-center justify-between bg-white rounded-lg shadow-md p-3 sm:p-4 mb-4 w-full">
            <div class="flex items-center gap-2 sm:gap-4">
                <span id="stage-display" class="text-lg sm:text-xl font-bold text-indigo-600">Stage 1 / 10</span>
                <div id="will-display" class="flex gap-1 text-2xl sm:text-3xl">
                    <!-- ì •ì‹ ë ¥ ì•„ì´ì½˜ (JSë¡œ ìƒì„±) -->
                </div>
            </div>
            <button id="hint-button" class="bg-yellow-400 hover:bg-yellow-500 text-gray-800 font-bold py-2 px-3 sm:px-4 rounded-lg shadow transition-all opacity-50 cursor-not-allowed text-sm sm:text-base">
                ğŸ’¡ íŒíŠ¸ (<span id="hint-count">1</span>)
            </button>
        </div>

        <!-- 2. AI ì˜ì—­ -->
        <div id="ai-area" class="mb-4">
            <div class="flex items-end gap-3 mb-2">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gray-300 rounded-full flex items-center justify-center text-xl sm:text-2xl shadow-inner">ğŸ¤–</div>
                <span id="ai-role" class="text-base sm:text-lg font-semibold text-gray-700">AI [ë°˜ëŒ€ ì¸¡]</span>
            </div>
            <div class="speech-bubble bg-gray-200 rounded-lg rounded-bl-none p-4 sm:p-5 text-gray-800 text-base sm:text-lg shadow-md">
                <p id="ai-claim">"AIê°€ ì²« ë²ˆì§¸ ì£¼ì¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤..."</p>
            </div>
        </div>

        <!-- 3. í”Œë ˆì´ì–´ ì„ íƒ ì˜ì—­ -->
        <div id="selection-area" class="bg-white rounded-lg shadow-inner p-3 sm:p-4 mb-4">
            <h3 class="text-xs sm:text-sm font-semibold text-gray-500 uppercase mb-3 text-center">ë‹¹ì‹ ì˜ ë°˜ë°• (ì£¼ì¥ 1 + ê·¼ê±° 1)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ì£¼ì¥ ì¹´ë“œ ìŠ¬ë¡¯ -->
                <div id="slot-claim" class="bg-gray-100 rounded-lg border-2 border-dashed border-blue-400 h-28 sm:h-32 flex items-center justify-center text-blue-600 font-semibold p-4 text-sm sm:text-base text-center">
                    ë°˜ë°• ì£¼ì¥ì„ ì´ê³³ì—
                </div>
                <!-- ê·¼ê±° ì¹´ë“œ ìŠ¬ë¡¯ -->
                <div id="slot-evidence" class="bg-gray-100 rounded-lg border-2 border-dashed border-red-400 h-28 sm:h-32 flex items-center justify-center text-red-600 font-semibold p-4 text-sm sm:text-base text-center">
                    ê·¼ê±°ë¥¼ ì´ê³³ì—
                </div>
            </div>
        </div>

        <!-- 4. í”Œë ˆì´ì–´ í•¸ë“œ (ìŠ¤í¬ë¡¤) -->
        <div id="player-hand-wrapper" class="flex-1 overflow-y-auto bg-gray-200 rounded-lg p-3 sm:p-4 shadow-inner">
            <!-- í•¸ë“œ íƒ€ì´í‹€ (JSë¡œ ë³€ê²½) -->
            <h3 id="hand-title" class="text-base sm:text-lg font-semibold text-gray-700 mb-3">1. ë°˜ë°• ì£¼ì¥ì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <div id="player-hand" class="grid grid-cols-2 md:grid-cols-3 gap-2 sm:gap-4">
                <!-- í”Œë ˆì´ì–´ ì¹´ë“œ (JSë¡œ ìƒì„±) -->
            </div>
        </div>

        <!-- 5. ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="mt-4 flex gap-4">
            <button id="submit-button" class="flex-1 bg-green-600 text-white font-bold py-3 sm:py-4 px-6 rounded-lg text-lg sm:text-xl shadow-lg transition-all opacity-50 cursor-not-allowed" disabled>
                ì£¼ì¥í•˜ê¸°
            </button>
            <button id="reset-selection-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 sm:py-4 px-6 rounded-lg text-base sm:text-lg shadow-lg transition-all">
                ë‹¤ì‹œ ì„ íƒ
            </button>
        </div>
    </div>

</div>

<!-- === ê²°ê³¼ ëª¨ë‹¬ (ìˆ¨ê¹€) === -->
<div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md text-center">
        <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold mb-4"></h2>
        <p id="modal-message" class="text-base sm:text-lg text-gray-700 mb-8 whitespace-pre-wrap"></p>
        <button id="modal-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg transition-colors">
            <!-- ë²„íŠ¼ í…ìŠ¤íŠ¸ (JSë¡œ ì„¤ì •) -->
        </button>
    </div>
</div>

<script>
    // --- 1. ê²Œì„ ë°ì´í„° (1:1 ë§¤ì¹­ìœ¼ë¡œ í™•ì¥) ---
    const MASTER_CARDS = {
        // --- ì°¬ì„± (ì œí•œ í•„ìš”) ---
        "pro-claim-1": { type: "claim", text: "í‘œí˜„ì˜ ììœ ë„ ì¤‘ìš”í•˜ì§€ë§Œ, ì²­ì†Œë…„ì„ ìœ í•´ ì •ë³´ë¡œë¶€í„° ë³´í˜¸í•˜ëŠ” ê²ƒì´ ë” ì‹œê¸‰í•©ë‹ˆë‹¤." },
        "pro-claim-2": { type: "claim", text: "SNSëŠ” 'ì¤‘ë…'ì„ ìœ ë°œí•˜ë„ë¡ ì„¤ê³„ë˜ì–´, ê±´ê°•í•œ ì¼ìƒ(ìˆ˜ë©´, í•™ìŠµ)ì„ ë§ê°€ëœ¨ë¦½ë‹ˆë‹¤." },
        "pro-claim-3": { type: "claim", text: "ê°€ìƒ ê³µê°„ì—ë§Œ ëª°ë‘í•˜ë©´, ì‹¤ì œ ëŒ€ë©´ ì†Œí†µ ëŠ¥ë ¥ê³¼ ê³µê° ëŠ¥ë ¥ì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
        "pro-claim-4": { type: "claim", text: "SNSëŠ” íƒ€ì¸ê³¼ ëŠì„ì—†ì´ ë¹„êµí•˜ê²Œ ë§Œë“¤ì–´, ì†Œì™¸ê°(FOMO)ê³¼ ìƒëŒ€ì  ë°•íƒˆê°ì„ ì¡°ì¥í•©ë‹ˆë‹¤." },
        "pro-claim-5": { type: "claim", text: "ì‚¬ì´ë²„ë¶ˆë§, ì‹ ìƒí„¸ê¸° ë“± ì²­ì†Œë…„ ëŒ€ìƒ ë²”ì£„ê°€ SNSë¥¼ í†µí•´ ë°œìƒí•˜ë¯€ë¡œ ê°•ë ¥í•œ ê·œì œê°€ í•„ìš”í•©ë‹ˆë‹¤." },
        "pro-claim-6": { type: "claim", text: "ì•„ì§ ë¹„íŒì  ì‚¬ê³ ê°€ ë¯¸ìˆ™í•œ ì²­ì†Œë…„ì—ê²Œ 'ì ˆëŒ€ì ì¸ ììœ 'ëŠ” ìœ„í—˜í•˜ë©°, ë³´í˜¸ ì¥ì¹˜ê°€ ë¨¼ì €ì…ë‹ˆë‹¤." },
        "pro-claim-7": { type: "claim", text: "ê°€ì • ë‚´ ì§€ë„ë¡œëŠ” í•œê³„ê°€ ëª…í™•í•©ë‹ˆë‹¤. ë²•ì , ì œë„ì  ìµœì†Œí•œì˜ ì•ˆì „ë§ì´ í•„ìš”í•©ë‹ˆë‹¤." },
        "pro-claim-8": { type: "claim", text: "ì„±ì¸ ì¸ì¦, ì•¼ê°„ ì…§ë‹¤ìš´ ë“± ì—°ë ¹/ì‹œê°„ì— ë”°ë¥¸ êµ¬ì²´ì ì¸ ì œí•œì´ ì‹¤ì§ˆì ì¸ ë³´í˜¸ ìˆ˜ë‹¨ì…ë‹ˆë‹¤." },
        "pro-claim-9": { type: "claim", text: "ê³µë¶€ì™€ ê³¼ì œì— ì§‘ì¤‘í•´ì•¼ í•  ì‹œê¸°ì—, SNSëŠ” ê°€ì¥ í° í•™ìŠµ ë°©í•´ ìš”ì†Œì…ë‹ˆë‹¤." },
        "pro-claim-10": { type: "claim", text: "ê°€ì§œë‰´ìŠ¤ì™€ ì„ ë™ ìë£Œê°€ ë¬´ë¶„ë³„í•˜ê²Œ ìœ í¬ë˜ëŠ” í†µë¡œì´ë¯€ë¡œ, ì²­ì†Œë…„ ì ‘ê·¼ì„ ì œí•œí•´ì•¼ í•©ë‹ˆë‹¤." },
        "pro-claim-joker1": { type: "claim", text: "SNSëŠ” ë¡œê³ ê°€ íŒŒë€ìƒ‰ì´ë¼ì„œ ê¸°ë¶„ì´ ìš°ìš¸í•´ì§€ë‹ˆ ê¸ˆì§€í•´ì•¼ í•©ë‹ˆë‹¤.", joker: true },

        "pro-evidence-1": { type: "evidence", text: "SNS ì‚¬ìš© ì‹œê°„ì´ ê¸´ ì²­ì†Œë…„ì¼ìˆ˜ë¡ ìš°ìš¸ê°ê³¼ ë¶ˆì•ˆê°ì„ ëŠë‚„ í™•ë¥ ì´ ë†’ë‹¤ëŠ” êµ¬ì²´ì ì¸ ì—°êµ¬ ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤." },
        "pro-evidence-2": { type: "evidence", text: "ì²­ì†Œë…„ë“¤ì€ ì‚¬ì´ë²„ë¶ˆë§, ì‹ ìƒí„¸ê¸°, ë””ì§€í„¸ ì„±ë²”ì£„ ë“± ì¦‰ê°ì ì¸ ìœ„í—˜ì— ë…¸ì¶œë˜ê¸° ì‰½ìŠµë‹ˆë‹¤." },
        "pro-evidence-3": { type: "evidence", text: "êµ­ë‚´ í†µê³„ì— ë”°ë¥´ë©´ ì²­ì†Œë…„ 10ëª… ì¤‘ 3ëª…ì´ 'SNS ì¤‘ë… ìœ„í—˜êµ°'ìœ¼ë¡œ ë¶„ë¥˜ë˜ì–´, ë‹¨ìˆœí•œ ë†€ì´ ìˆ˜ì¤€ì„ ë„˜ì—ˆìŠµë‹ˆë‹¤." },
        "pro-evidence-4": { type: "evidence", text: "ì „ë¬¸ê°€ë“¤ì€ 14ì„¸ ë¯¸ë§Œì€ ìœ í•´ ì •ë³´ì— ëŒ€í•œ ë¹„íŒì  ì‚¬ê³ ê°€ ë¯¸ìˆ™í•˜ë¯€ë¡œ, 'ë³´í˜¸ë°›ì„ ê¶Œë¦¬'ê°€ ìš°ì„ ë˜ì–´ì•¼ í•œë‹¤ê³  ì¡°ì–¸í•©ë‹ˆë‹¤." },
        "pro-evidence-5": { type: "evidence", text: "íƒ€ì¸ì˜ ê³¼ì¥ëœ í–‰ë³µì„ ë³´ë©° 'ë‚˜ë§Œ ë’¤ì²˜ì§€ëŠ” ê²ƒ'ì„ ë‘ë ¤ì›Œí•˜ëŠ” 'FOMO ì¦í›„êµ°'ì€ ì²­ì†Œë…„ì˜ ì •ì‹  ê±´ê°•ì— ì•…ì˜í–¥ì„ ì¤ë‹ˆë‹¤." },
        "pro-evidence-6": { type: "evidence", text: "ëŒ€ë©´ ì†Œí†µì´ ì¤„ë©´ ê°ˆë“± ì¡°ìœ¨ ëŠ¥ë ¥ì´ ë–¨ì–´ì ¸, í•™êµ í­ë ¥ì´ ì‚¬ì´ë²„ë¶ˆë§ ê°™ì€ ìƒˆë¡œìš´ ì–‘ìƒìœ¼ë¡œ ë²ˆì§€ê¸°ë„ í•©ë‹ˆë‹¤." },
        "pro-evidence-7": { type: "evidence", text: "ìˆ˜ë©´ ë¶€ì¡±ì€ ë‡Œ ë°œë‹¬ì— ì¹˜ëª…ì ì´ë©°, ì•¼ê°„ SNS ì‚¬ìš©ì€ ì²­ì†Œë…„ì˜ ìˆ˜ë©´ì˜ ì§ˆì„ ì‹¬ê°í•˜ê²Œ ì €í•˜í•©ë‹ˆë‹¤." },
        "pro-evidence-8": { type: "evidence", text: "ì‹¤ì œ ë§ì€ ì²­ì†Œë…„ ë²”ì£„ê°€ SNSì—ì„œ ë§Œë‚˜ ê³„íšë˜ê³  ì‹¤í–‰ë˜ëŠ” ë“±, ë²”ì£„ì˜ ì˜¨ìƒì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤." },
        "pro-evidence-9": { type: "evidence", text: "ë¯¸êµ­, í”„ë‘ìŠ¤ ë“± ì—¬ëŸ¬ êµ­ê°€ì—ì„œë„ ì²­ì†Œë…„ì˜ SNS ì‚¬ìš©ì„ ì œí•œí•˜ëŠ” ë²•ì•ˆì„ ë„ì…í–ˆê±°ë‚˜ ë…¼ì˜ ì¤‘ì…ë‹ˆë‹¤." },
        "pro-evidence-10": { type: "evidence", text: "SNSì˜ ì•Œê³ ë¦¬ì¦˜ì€ ì‚¬ìš©ìë¥¼ ìê·¹ì ì¸ ì½˜í…ì¸ ì—ë§Œ ë¨¸ë¬´ë¥´ê²Œ í•˜ì—¬, ìƒê°ì˜ í­ì„ ì¢íˆëŠ” 'í•„í„° ë²„ë¸”'ì„ ë§Œë“­ë‹ˆë‹¤." },
        "pro-evidence-joker1": { type: "evidence", text: "í†µê³„ì²­ì— ë”°ë¥´ë©´, ìš°ë¦¬ë‚˜ë¼ 1ì¸ë‹¹ ì—°ê°„ ìŒ€ ì†Œë¹„ëŸ‰ì€ 56.7kgì…ë‹ˆë‹¤.", joker: true },

        // --- ë°˜ëŒ€ (í—ˆìš©/ììœ¨) ---
        "con-claim-1": { type: "claim", text: "ë¬´ì¡°ê±´ ë§‰ëŠ” ê²ƒì€ ë‹µì´ ì•„ë‹™ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²•(ë¦¬í„°ëŸ¬ì‹œ)ì„ êµìœ¡í•˜ëŠ” ê²ƒì´ ìš°ì„ ì…ë‹ˆë‹¤." },
        "con-claim-2": { type: "claim", text: "SNSëŠ” ì²­ì†Œë…„ì˜ ë‹¹ì—°í•œ 'í‘œí˜„ì˜ ììœ 'ì´ë©°, ê°•ì œë¡œ ë§‰ëŠ” ê²ƒì€ ì†Œí†µ ê¶Œë¦¬ë¥¼ ì¹¨í•´í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤." },
        "con-claim-3": { type: "claim", text: "ì •ë³´ ê²©ì°¨ë¥¼ í•´ì†Œí•˜ê³ , ì§€ì—­ì´ë‚˜ í™˜ê²½ì— ìƒê´€ì—†ì´ ë™ë“±í•œ í•™ìŠµ ê¸°íšŒë¥¼ ì œê³µí•˜ëŠ” ìˆœê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤." },
        "con-claim-4": { type: "claim", text: "ì •ë³´ë¥¼ ì°¾ê³ , ë¹„íŒí•˜ê³ , í™œìš©í•˜ëŠ” 'ë””ì§€í„¸ ì‹œë¯¼ì˜ì‹'ì„ ê¸°ë¥´ê¸° ìœ„í•´ ë°˜ë“œì‹œ í•„ìš”í•œ ë„êµ¬ì…ë‹ˆë‹¤." },
        "con-claim-5": { type: "claim", text: "ìœ„í—˜ì€ ì¡´ì¬í•˜ì§€ë§Œ, ì‹ ê³ /ì°¨ë‹¨ ê¸°ëŠ¥ ë“± ìŠ¤ìŠ¤ë¡œë¥¼ ë³´í˜¸í•  ì¥ì¹˜ë„ ì´ë¯¸ ë§ˆë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤." },
        "con-claim-6": { type: "claim", text: "ì²­ì†Œë…„ì„ 'ë³´í˜¸ ëŒ€ìƒ'ìœ¼ë¡œë§Œ ë³´ëŠ” ê²ƒì€, ê·¸ë“¤ì˜ ììœ¨ì„±ê³¼ íŒë‹¨ë ¥ì„ ë¬´ì‹œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤." },
        "con-claim-7": { type: "claim", text: "ì œí•œì€ ì˜¤íˆë ¤ ìŒì§€ ë¬¸í™”ë¥¼ ë§Œë“¤ ë¿ì…ë‹ˆë‹¤. ì–‘ì§€ë¡œ ëŒì–´ë‚´ êµìœ¡í•˜ëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤." },
        "con-claim-8": { type: "claim", text: "ê¸´ê¸‰ ì¬ë‚œì´ë‚˜ ìœ„ê¸‰ ìƒí™© ì‹œ, SNSëŠ” ê°€ì¥ ë¹ ë¥¸ ì—°ë½ ë° ì •ë³´ ê³µìœ  ìˆ˜ë‹¨ì´ ë©ë‹ˆë‹¤." },
        "con-claim-9": { type: "claim", text: "ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ê³¼ êµë¥˜í•˜ë©° ì‚¬íšŒì„±ì„ ê¸°ë¥´ê³ , ìì‹ ì˜ ì •ì²´ì„±ì„ í‘œí˜„í•˜ëŠ” ì¤‘ìš”í•œ ì°½êµ¬ì…ë‹ˆë‹¤." },
        "con-claim-10": { type: "claim", text: "ì¼ë¥ ì ì¸ ì œí•œë³´ë‹¤ëŠ”, ê°€ì • í™˜ê²½ê³¼ ê°œì¸ì˜ ì„±ìˆ™ë„ì— ë”°ë¥¸ 'ììœ¨ì  ì„ íƒ'ì´ ì¤‘ìš”í•©ë‹ˆë‹¤." },
        "con-claim-joker1": { type: "claim", text: "ëª¨ë“  í•™ìƒì€ ì•„ì¹¨ìœ¼ë¡œ í”¼ìë¥¼ ë¨¹ì„ ê¶Œë¦¬ê°€ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.", joker: true },

        "con-evidence-1": { type: "evidence", text: "ì¹œêµ¬ë“¤ê³¼ ì˜¨ë¼ì¸ ìŠ¤í„°ë”” ê·¸ë£¹ì„ ë§Œë“¤ê±°ë‚˜, ê³¼ì œ ìˆ˜í–‰ì„ ìœ„í•´ ìë£Œë¥¼ ê³µìœ í•˜ëŠ” ë“± ê¸ì •ì ì¸ í™œìš© ì‚¬ë¡€ê°€ ë§ìŠµë‹ˆë‹¤." },
        "con-evidence-2": { type: "evidence", text: "ë””ì§€í„¸ ë¦¬í„°ëŸ¬ì‹œ êµìœ¡(ì‹ ê³ /ì°¨ë‹¨ ê¸°ëŠ¥, ê°€ì§œë‰´ìŠ¤ íŒë³„)ì„ ë°›ì€ í•™ìƒì€ ìŠ¤ìŠ¤ë¡œ ìœ„í—˜ì„ ëŒ€ì²˜í•  í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤." },
        "con-evidence-3": { type: "evidence", text: "í—Œë²•ì—ì„œ ë³´ì¥í•˜ëŠ” 'í‘œí˜„ì˜ ììœ 'ëŠ” í•µì‹¬ ê¸°ë³¸ê¶Œì´ë¯€ë¡œ, ì²­ì†Œë…„ì´ë¼ëŠ” ì´ìœ ë¡œ ê³¼ë„í•˜ê²Œ ì œí•œí•˜ëŠ” ê²ƒì€ ìœ„í—Œ ì†Œì§€ê°€ ìˆìŠµë‹ˆë‹¤." },
        "con-evidence-4": { type: "evidence", text: "ê¸´ê¸‰ ì¬ë‚œ(ì§€ì§„ ë“±) ìƒí™©ì—ì„œ ì •ë³´ë¥¼ ë¹ ë¥´ê²Œ ì „íŒŒí•˜ê±°ë‚˜, ìœ„ê¸° ì‹œ ì¹œêµ¬ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•˜ëŠ” ìƒëª…ì˜ ì°½êµ¬ê°€ ë©ë‹ˆë‹¤." },
        "con-evidence-5": { type: "evidence", text: "ì •ë³´ì˜ í™ìˆ˜ ì†ì—ì„œ ìœ ìµí•œ ì •ë³´ë¥¼ ì°¾ê³ , ê°€ì§œë‰´ìŠ¤ë¥¼ íŒë³„í•˜ëŠ” ëŠ¥ë ¥(ë¯¸ë””ì–´ ë¦¬í„°ëŸ¬ì‹œ)ì€ ë¯¸ë˜ ì‚¬íšŒì˜ í•µì‹¬ ì—­ëŸ‰ì…ë‹ˆë‹¤." },
        "con-evidence-6": { type: "evidence", text: "ìì‹ ì˜ ì˜ê²¬ì„ í‘œí˜„í•˜ê³ , ì‚¬íšŒ/ì •ì¹˜ì  ìº í˜ì¸ì— ì°¸ì—¬í•˜ëŠ” ë“± ë¯¼ì£¼ì£¼ì˜ì™€ ì‚¬íšŒ ì°¸ì—¬ë¥¼ í•™ìŠµí•˜ëŠ” ê¸ì •ì ì¸ ì°½êµ¬ê°€ ë©ë‹ˆë‹¤." },
        "con-evidence-7": { type: "evidence", text: "ê³¼ê±° 'ê²Œì„ ì…§ë‹¤ìš´ì œ'ê°€ ì‹¤íš¨ì„± ì—†ì´ ì²­ì†Œë…„ì˜ ê¶Œë¦¬ë§Œ ì¹¨í•´í–ˆë‹¤ëŠ” ë¹„íŒì„ ì°¸ê³ í•´ì•¼ í•©ë‹ˆë‹¤." },
        "con-evidence-8": { type: "evidence", text: "ìœ ì—”ì•„ë™ê¶Œë¦¬í˜‘ì•½ì€ ì•„ë™/ì²­ì†Œë…„ì˜ ì •ë³´ ì ‘ê·¼ê¶Œê³¼ í‘œí˜„ì˜ ììœ ë¥¼ ë³´ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤." },
        "con-evidence-9": { type: "evidence", text: "ê´€ì‹¬ì‚¬ê°€ ê°™ì€ ì¹œêµ¬ë“¤ì„ ì˜¨ë¼ì¸ì—ì„œ ë§Œë‚˜ë©° ì†Œì™¸ê°ì„ ê·¹ë³µí•˜ê³ , ê¸ì •ì ì¸ ìì•„ë¥¼ í˜•ì„±í•œ ì‚¬ë¡€ë„ ë§ìŠµë‹ˆë‹¤." },
        "con-evidence-10": { type: "evidence", text: "ìŠ¤ìŠ¤ë¡œ ì‹œê°„ì„ ì¡°ì ˆí•˜ê³  ì±…ì„ì§€ëŠ” ë²•ì„ ë°°ìš°ëŠ” ê²ƒë„ 'ì„±ì¥ ê³¼ì •'ì˜ ì¼ë¶€ì…ë‹ˆë‹¤." },
        "con-evidence-joker1": { type: "evidence", text: "ê³¼í•™ì  ì‚¬ì‹¤ì— ë”°ë¥´ë©´, ì§€êµ¬ëŠ” íƒœì–‘ ì£¼ìœ„ë¥¼ 1ë…„ì— í•œ ë°”í€´ ë•ë‹ˆë‹¤.", joker: true }
    };

    const PLAYER_HANDS = {
        pro: [
            "pro-claim-1", "pro-claim-2", "pro-claim-3", "pro-claim-4", "pro-claim-5", "pro-claim-6", "pro-claim-7", "pro-claim-8", "pro-claim-9", "pro-claim-10", "pro-claim-joker1",
            "pro-evidence-1", "pro-evidence-2", "pro-evidence-3", "pro-evidence-4", "pro-evidence-5", "pro-evidence-6", "pro-evidence-7", "pro-evidence-8", "pro-evidence-9", "pro-evidence-10", "pro-evidence-joker1"
        ],
        con: [
            "con-claim-1", "con-claim-2", "con-claim-3", "con-claim-4", "con-claim-5", "con-claim-6", "con-claim-7", "con-claim-8", "con-claim-9", "con-claim-10", "con-claim-joker1",
            "con-evidence-1", "con-evidence-2", "con-evidence-3", "con-evidence-4", "con-evidence-5", "con-evidence-6", "con-evidence-7", "con-evidence-8", "con-evidence-9", "con-evidence-10", "con-evidence-joker1"
        ]
    };

    // --- (ìˆ˜ì •) ìŠ¤í…Œì´ì§€ ë°ì´í„°: "ë‹¨ì¼ ì •ë‹µ 1:1 ë§¤ì¹­"ìœ¼ë¡œ ë³€ê²½ ---
    const STAGE_SET_A = [ // Player: Pro
        { "id": "S1", "ai_stance": "con", "ai_claim": "SNSë¥¼ ê¸ˆì§€í•˜ê±°ë‚˜ ì œí•œí•˜ë©´ í‘œí˜„ì˜ ììœ ê°€ ì¤„ì–´ë“¤ì–´ìš”.", "ok_claim_id": "pro-claim-1", "ok_evidence_id": "pro-evidence-4" },
        { "id": "S2", "ai_stance": "con", "ai_claim": "ì¹œêµ¬Â·ê°€ì¡±ê³¼ ì†Œí†µí•˜ë ¤ë©´ SNSê°€ ê¼­ í•„ìš”í•´ìš”.", "ok_claim_id": "pro-claim-3", "ok_evidence_id": "pro-evidence-6" },
        { "id": "S3", "ai_stance": "con", "ai_claim": "ê¸ˆì§€ë³´ë‹¤ ì˜¬ë°”ë¥¸ ì‚¬ìš©ë²• êµìœ¡ì´ ë” íš¨ê³¼ì ì´ì—ìš”.", "ok_claim_id": "pro-claim-7", "ok_evidence_id": "pro-evidence-9" },
        { "id": "S4", "ai_stance": "con", "ai_claim": "ì‹ ê³ Â·ì°¨ë‹¨ ê¸°ëŠ¥ì´ ìˆìœ¼ë‹ˆ ìœ„í—˜í•´ë„ ìŠ¤ìŠ¤ë¡œ í•´ê²°í•  ìˆ˜ ìˆì–´ìš”.", "ok_claim_id": "pro-claim-5", "ok_evidence_id": "pro-evidence-8" },
        { "id": "S5", "ai_stance": "con", "ai_claim": "ê³¼ì œë‚˜ ê³µë¶€ì—ë„ SNS ìë£Œê°€ ë„ì›€ì´ ë¼ìš”.", "ok_claim_id": "pro-claim-9", "ok_evidence_id": "pro-evidence-10" },
        { "id": "S6", "ai_stance": "con", "ai_claim": "ì—°ë ¹ê³¼ ìƒê´€ì—†ì´ ì±…ì„ê°ë§Œ ìˆìœ¼ë©´ ìŠ¤ìŠ¤ë¡œ ì¡°ì ˆí•  ìˆ˜ ìˆì–´ìš”.", "ok_claim_id": "pro-claim-2", "ok_evidence_id": "pro-evidence-3" },
        { "id": "S7", "ai_stance": "con", "ai_claim": "ë°¤ì—ë„ ì¹œêµ¬ê°€ ë„ì™€ë‹¬ë¼ë©´ ë°”ë¡œ ì—°ë½í•´ì•¼ í•˜ì–ì•„ìš”.", "ok_claim_id": "pro-claim-8", "ok_evidence_id": "pro-evidence-7" },
        { "id": "S8", "ai_stance": "con", "ai_claim": "ë‹¤ë“¤ ì“°ëŠ”ë° í˜¼ìë§Œ ì œí•œí•˜ë©´ ì†Œì™¸ë  ìˆ˜ ìˆì–´ìš”.", "ok_claim_id": "pro-claim-4", "ok_evidence_id": "pro-evidence-5" },
        { "id": "S9", "ai_stance": "con", "ai_claim": "ê°€ì •ì—ì„œë§Œ ì§€ì¼œë³´ë©´ ì¶©ë¶„í•˜ê³  ê·œì¹™ê¹Œì§„ í•„ìš” ì—†ì–´ìš”.", "ok_claim_id": "pro-claim-6", "ok_evidence_id": "pro-evidence-2" },
        { "id": "S10", "ai_stance": "con", "ai_claim": "ì œí•œì€ ê³¼í•´ìš”. ì™„ì „ ììœ ê°€ ë” ë‚«ì£ .", "ok_claim_id": "pro-claim-10", "ok_evidence_id": "pro-evidence-1" }
    ];

    const STAGE_SET_B = [ // Player: Con
        { "id": "A1", "ai_stance": "pro", "ai_claim": "ì´ˆë“±í•™ìƒì€ íŒë‹¨ë ¥ì´ ë¯¸ìˆ™í•˜ë‹ˆ ì—°ë ¹ì— ë”°ë¼ ì œí•œí•´ì•¼ í•´ìš”.", "ok_claim_id": "con-claim-6", "ok_evidence_id": "con-evidence-10" },
        { "id": "A2", "ai_stance": "pro", "ai_claim": "ë°¤ ëŠ¦ê²Œ SNSë¥¼ ì“°ë©´ ìˆ˜ë©´ê³¼ ì§‘ì¤‘ë ¥ì´ ë§ê°€ì ¸ìš”. ì•¼ê°„ ì œí•œì´ í•„ìš”í•´ìš”.", "ok_claim_id": "con-claim-7", "ok_evidence_id": "con-evidence-7" },
        { "id": "A3", "ai_stance": "pro", "ai_claim": "SNS ì•Œë¦¼ ë•Œë¬¸ì— ìˆ™ì œê°€ ë°©í•´ë¼ìš”. ê³µë¶€ ìš°ì„ ì´ ë˜ë ¤ë©´ ì œí•œí•´ì•¼ í•´ìš”.", "ok_claim_id": "con-claim-3", "ok_evidence_id": "con-evidence-1" },
        { "id": "A4", "ai_stance": "pro", "ai_claim": "ì‚¬ì´ë²„í­ë ¥ê³¼ ê°œì¸ì •ë³´ ìœ ì¶œì´ ìœ„í—˜í•˜ë‹ˆ ì œí•œì´ í•„ìš”í•´ìš”.", "ok_claim_id": "con-claim-5", "ok_evidence_id": "con-evidence-2" },
        { "id": "A5", "ai_stance": "pro", "ai_claim": "ë°œë‹¬ ë‹¨ê³„ìƒ ê°ì • ì¡°ì ˆì´ ì–´ë ¤ì›Œì„œ ë‹¨ê³„ë³„ ê·œì¹™ì´ ê¼­ í•„ìš”í•´ìš”.", "ok_claim_id": "con-claim-9", "ok_evidence_id": "con-evidence-9" },
        { "id": "A6", "ai_stance": "pro", "ai_claim": "ê°€ì •ì—ì„œì˜ ê´€ë¦¬ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•´ìš”. ì¼ê´„ ì œí•œì´ ë” ì•ˆì „í•´ìš”.", "ok_claim_id": "con-claim-10", "ok_evidence_id": "con-evidence-3" },
        { "id": "A7", "ai_stance": "pro", "ai_claim": "ë°¤ì—ë„ ìœ„í—˜í•œ ì¼ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ìš”. ê·¸ë˜ì„œ ì•¼ê°„ ì œí•œì´ í•„ìš”í•˜ì£ .", "ok_claim_id": "con-claim-8", "ok_evidence_id": "con-evidence-4" },
        { "id": "A8", "ai_stance": "pro", "ai_claim": "ë‹¤ë“¤ ì“°ë‹¤ ë³´ë©´ ì¤‘ë…ë  ìˆ˜ ìˆì–´ìš”. ì œí•œìœ¼ë¡œ ìŠµê´€ì„ ì¡ì•„ì•¼ í•´ìš”.", "ok_claim_id": "con-claim-1", "ok_evidence_id": "con-evidence-5" },
        { "id": "A9", "ai_stance": "pro", "ai_claim": "ê³¼ì œ ì¤‘ì—ëŠ” SNSê°€ ì‚°ë§Œí•¨ì„ ë§Œë“¤ì–´ìš”. ì‚¬ìš©ì„ ë§‰ì•„ì•¼ ì§‘ì¤‘ë¼ìš”.", "ok_claim_id": "con-claim-4", "ok_evidence_id": "con-evidence-6" },
        { "id": "A10", "ai_stance": "pro", "ai_claim": "ì „ë©´ ì œí•œì´ ê°€ì¥ ì•ˆì „í•´ìš”. ì˜ˆì™¸ë¥¼ ë‘ë©´ êµ¬ë©ì´ ìƒê²¨ìš”.", "ok_claim_id": "con-claim-2", "ok_evidence_id": "con-evidence-8" }
    ];

    // ê²Œì„ ì„¤ì •
    const GAME_CONFIG = {
        totalStages: 10,
        startingWill: 3,
        hintsPerRun: 1,
        easyStages: 3,
    };

    // --- 2. DOM ìš”ì†Œ ---
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const startProButton = document.getElementById('start-pro');
    const startConButton = document.getElementById('start-con');
    const stageDisplay = document.getElementById('stage-display');
    const willDisplay = document.getElementById('will-display');
    const hintButton = document.getElementById('hint-button');
    const hintCount = document.getElementById('hint-count');
    const aiRole = document.getElementById('ai-role');
    const aiClaim = document.getElementById('ai-claim');
    const slotClaim = document.getElementById('slot-claim');
    const slotEvidence = document.getElementById('slot-evidence');
    const handTitle = document.getElementById('hand-title');
    const playerHand = document.getElementById('player-hand');
    const submitButton = document.getElementById('submit-button');
    const resetSelectionButton = document.getElementById('reset-selection-button');
    const resultModal = document.getElementById('result-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    let modalButton = document.getElementById('modal-button');

    // --- 3. ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
    let currentStageIndex = 0;
    let mentalPower = GAME_CONFIG.startingWill;
    let hintsLeft = GAME_CONFIG.hintsPerRun;
    let playerStance = null;
    let currentStageSet = [];
    let currentPlayerHandIds = [];
    let selectedClaimId = null;
    let selectedEvidenceId = null;
    let gameInProgress = false;
    let selectionPhase = 'claim';
    let hintActive = false;
    let hintPool = [];
    let currentHandCache = [];

    // --- 4. í•µì‹¬ ê²Œì„ ë¡œì§ ---

    const shuffle = (array) => {
        let newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
    };

    function initGame() {
        gameInProgress = false;
        startScreen.classList.remove('hidden');
        startScreen.classList.add('flex');
        gameScreen.classList.add('hidden');
        gameScreen.classList.remove('flex');
        resultModal.classList.add('hidden');
    }

    function startGame(stance) {
        playerStance = stance;
        currentStageIndex = 0;
        mentalPower = GAME_CONFIG.startingWill;
        hintsLeft = GAME_CONFIG.hintsPerRun;
        gameInProgress = true;

        if (stance === 'pro') {
            currentStageSet = STAGE_SET_A;
            currentPlayerHandIds = PLAYER_HANDS.pro;
            aiRole.textContent = "AI [ë°˜ëŒ€ ì¸¡]";
        } else {
            currentStageSet = STAGE_SET_B;
            currentPlayerHandIds = PLAYER_HANDS.con;
            aiRole.textContent = "AI [ì°¬ì„± ì¸¡]";
        }

        slotClaim.innerHTML = 'ë°˜ë°• ì£¼ì¥ì„ ì´ê³³ì—';
        slotEvidence.innerHTML = 'ê·¼ê±°ë¥¼ ì´ê³³ì—';
        selectedClaimId = null;
        selectedEvidenceId = null;

        startScreen.classList.add('hidden');
        startScreen.classList.remove('flex');
        gameScreen.classList.remove('hidden');
        gameScreen.classList.add('flex');

        loadStage(currentStageIndex);
        updateStatusUI();
        resetHintButton();
    }

    function createCardElement(id, data) {
        const el = document.createElement('div');
        el.id = `card-${id}`;
        el.dataset.id = id;
        el.dataset.type = data.type;

        const isClaim = data.type === 'claim';
        const bgColor = isClaim ? 'bg-blue-100' : 'bg-red-100';
        const borderColor = isClaim ? 'border-blue-300' : 'border-red-300';
        const headerText = isClaim ? 'ë°˜ë°• ì£¼ì¥' : 'ê·¼ê±°';
        const headerColor = isClaim ? 'text-blue-700' : 'text-red-700';

        if (data.joker) {
            el.classList.add('opacity-80', 'border-gray-400');
        }

        el.className += ` card ${bgColor} border-b-4 ${borderColor} rounded-lg p-3 sm:p-4 shadow-md min-h-[120px] sm:min-h-[140px] flex flex-col justify-between`;
        el.innerHTML = `
                <span class="block text-xs font-bold ${headerColor} uppercase">${headerText}</span>
                <p class="text-gray-800 text-sm sm:text-base font-medium mt-2 flex-1">${data.text}</p>
            `;
        el.addEventListener('click', () => onCardClick(id, data.type));
        return el;
    }

    function loadStage(index) {
        if (index >= currentStageSet.length) {
            gameInProgress = false;
            showResultModal("ìµœì¢… ìŠ¹ë¦¬!", "ì¶•í•˜í•©ë‹ˆë‹¤! AIì˜ ëª¨ë“  ì£¼ì¥ì„ ì™„ë²½í•˜ê²Œ ë°˜ë°•í–ˆìŠµë‹ˆë‹¤.", "ë‹¤ì‹œ ì‹œì‘í•˜ê¸°", initGame);
            return;
        }
        const stage = currentStageSet[index];
        aiClaim.textContent = stage.ai_claim;
        resetStageUI();
    }

    function resetStageUI() {
        selectedClaimId = null;
        selectedEvidenceId = null;
        slotClaim.innerHTML = 'ë°˜ë°• ì£¼ì¥ì„ ì´ê³³ì—';
        slotEvidence.innerHTML = 'ê·¼ê±°ë¥¼ ì´ê³³ì—';
        selectionPhase = 'claim';
        hintActive = false;
        hintPool = [];
        currentHandCache = [];
        renderPlayerHand();
        checkSubmitButton();
        updateHintButtonState();
    }

    // (ë²„ê·¸ ìˆ˜ì •) í”Œë ˆì´ì–´ í•¸ë“œ ë Œë”ë§ (ë‹¨ì¼ ì •ë‹µ ë¡œì§ ê¸°ì¤€)
    function renderPlayerHand() {
        playerHand.innerHTML = '';
        let idsToShow = [];

        const stage = currentStageSet[currentStageIndex];
        const isEarlyStage = currentStageIndex < GAME_CONFIG.easyStages; // 0, 1, 2

        // 1. ê³µí†µ í’€ ì •ì˜
        const allClaims = currentPlayerHandIds.filter(id => MASTER_CARDS[id].type === 'claim');
        const allEvidence = currentPlayerHandIds.filter(id => MASTER_CARDS[id].type === 'evidence');

        // --- (ìˆ˜ì •) ë‹¨ì¼ ì •ë‹µ IDë¥¼ ë°°ì—´ë¡œ ê°ì‹¸ì„œ ê¸°ì¡´ ë¡œì§ ì¬í™œìš© ---
        const okClaims = [stage.ok_claim_id];
        const okEvidence = [stage.ok_evidence_id];

        // --- (ìˆ˜ì •) ì´ì œ incorrect í’€ì´ í•­ìƒ ë„‰ë„‰í•˜ê²Œ ë³´ì¥ë¨ (10 normal + 1 joker) ---
        const incorrectClaims = allClaims.filter(id => id !== stage.ok_claim_id);
        const incorrectEvidence = allEvidence.filter(id => id !== stage.ok_evidence_id);

        // 2. ì˜¤ë‹µ í’€ ë¶„ë¦¬ (ì¡°ì»¤ / ë§¤ë ¥ì )
        const jokerClaims = incorrectClaims.filter(id => MASTER_CARDS[id].joker);
        const attractiveClaims = incorrectClaims.filter(id => !MASTER_CARDS[id].joker);
        const jokerEvidence = incorrectEvidence.filter(id => MASTER_CARDS[id].joker);
        const attractiveEvidence = incorrectEvidence.filter(id => !MASTER_CARDS[id].joker);

        // (ê³µí†µ) ì˜¤ë‹µ 3ê°œ ë½‘ëŠ” í—¬í¼ í•¨ìˆ˜
        const getThreeIncorrect = (jokerPool, attractivePool, incorrectPool) => {
            let incorrectSet = [];
            if (isEarlyStage && jokerPool.length > 0) {
                incorrectSet.push(shuffle(jokerPool)[0]); // 1 Joker
            }

            // 3ê°œê°€ ë  ë•Œê¹Œì§€ 'ë§¤ë ¥ì  ì˜¤ë‹µ'ìœ¼ë¡œ ì±„ì›€ (ì´ë¯¸ ë„£ì€ ì¡°ì»¤ ì œì™¸)
            const attractiveNeeded = 3 - incorrectSet.length;
            const attractiveToAdd = shuffle(attractivePool.filter(id => !incorrectSet.includes(id))).slice(0, attractiveNeeded);
            incorrectSet.push(...attractiveToAdd);

            // [ë²„ê·¸ ìˆ˜ì •] ê·¸ë˜ë„ 3ê°œê°€ ì•ˆë˜ë©´, 'ì „ì²´ ì˜¤ë‹µ'ì—ì„œ ë§ˆì € ì±„ì›€
            const finalNeeded = 3 - incorrectSet.length;
            if (finalNeeded > 0) {
                // ì´ ë¡œì§ì€ ì´ì œ ê±°ì˜ ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ, ë§Œì•½ì˜ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì•ˆì „ ì¥ì¹˜
                const finalFallbackPool = incorrectPool.filter(id => !incorrectSet.includes(id));
                incorrectSet.push(...shuffle(finalFallbackPool).slice(0, finalNeeded));
            }
            return incorrectSet;
        };


        if (selectionPhase === 'claim') {
            // --- 3A. ì£¼ì¥ ì„ íƒì§€ êµ¬ì„± (4ê°œ) ---
            handTitle.textContent = '1. ë°˜ë°• ì£¼ì¥ 4ê°œ ì¤‘ 1ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”';

            // 1ê°œëŠ” ë¬´ì¡°ê±´ ì •ë‹µ
            idsToShow.push(okClaims[0]);

            // 3ê°œëŠ” ì˜¤ë‹µ
            const incorrectSet = getThreeIncorrect(jokerClaims, attractiveClaims, incorrectClaims);
            idsToShow.push(...incorrectSet);

            idsToShow = shuffle(idsToShow);

        } else { // 'evidence'

            if (hintActive) {
                // --- 3B. ê·¼ê±° ì„ íƒ (íŒíŠ¸ ì‚¬ìš©) ---
                handTitle.textContent = '2. [íŒíŠ¸] 2ê°œì˜ ê·¼ê±° ì¤‘ ì„ íƒí•˜ì„¸ìš”';
                idsToShow = shuffle(hintPool);
            } else {
                // --- 3C. ê·¼ê±° ì„ íƒì§€ êµ¬ì„± (4ê°œ) ---
                handTitle.textContent = '2. ê·¼ê±° 4ê°œ ì¤‘ 1ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”';

                // 1ê°œëŠ” ë¬´ì¡°ê±´ ì •ë‹µ
                idsToShow.push(okEvidence[0]);

                // 3ê°œëŠ” ì˜¤ë‹µ
                const incorrectSet = getThreeIncorrect(jokerEvidence, attractiveEvidence, incorrectEvidence);
                idsToShow.push(...incorrectSet);

                idsToShow = shuffle(idsToShow);
            }
        }

        // 4. ë Œë”ë§
        currentHandCache = idsToShow; // íŒíŠ¸ ë¡œì§ì„ ìœ„í•´ ìºì‹œ
        idsToShow.forEach(id => {
            if (!id) return; // ì•ˆì „ ì¥ì¹˜
            const cardData = MASTER_CARDS[id];
            const cardEl = createCardElement(id, cardData);
            playerHand.appendChild(cardEl);
        });

        // ì¹´ë“œ ê°œìˆ˜ì— ë”°ë¥¸ ê·¸ë¦¬ë“œ ì¡°ì • (í•­ìƒ 2ì—´)
        playerHand.classList.add('md:grid-cols-2');
        playerHand.classList.remove('md:grid-cols-3');
    }

    // ìƒíƒœ UI ì—…ë°ì´íŠ¸
    function updateStatusUI() {
        stageDisplay.textContent = `Stage ${currentStageIndex + 1} / ${GAME_CONFIG.totalStages}`;
        willDisplay.innerHTML = '';
        for (let i = 0; i < GAME_CONFIG.startingWill; i++) {
            const heart = document.createElement('span');
            if (i < mentalPower) {
                heart.textContent = 'â¤ï¸';
                heart.className = 'heart-beat';
            } else {
                heart.textContent = 'ğŸ¤';
                heart.className = 'heart-empty';
            }
            willDisplay.appendChild(heart);
        }
    }

    // --- 5. ì¹´ë“œ ì„ íƒ ë¡œì§ ---

    // ì¹´ë“œ í´ë¦­ ì‹œ
    function onCardClick(id, type) {
        if (!gameInProgress) return;
        const cardData = MASTER_CARDS[id];

        if (type === 'claim' && selectionPhase === 'claim') {
            selectedClaimId = id;
            const cardElForSlot = createCardElement(id, cardData);
            cardElForSlot.classList.add('card-in-slot');
            slotClaim.innerHTML = '';
            slotClaim.appendChild(cardElForSlot);

            selectionPhase = 'evidence';
            renderPlayerHand();
            updateHintButtonState();

        } else if (type === 'evidence' && selectionPhase === 'evidence') {
            selectedEvidenceId = id;
            const cardElForSlot = createCardElement(id, cardData);
            cardElForSlot.classList.add('card-in-slot');
            slotEvidence.innerHTML = '';
            slotEvidence.appendChild(cardElForSlot);

            if (hintActive) {
                disableWrongHintCard();
            }
        }
        checkSubmitButton();
    }

    // ì œì¶œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
    function checkSubmitButton() {
        if (selectedClaimId && selectedEvidenceId) {
            submitButton.disabled = false;
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    // --- 6. ì œì¶œ ë° ê²°ê³¼ ì²˜ë¦¬ ---

    // 'ì£¼ì¥í•˜ê¸°' ë²„íŠ¼ í´ë¦­
    function handleSubmit() {
        if (submitButton.disabled || !gameInProgress) return;
        const stage = currentStageSet[currentStageIndex];

        // --- (ìˆ˜ì •) ë‹¨ì¼ ì •ë‹µìœ¼ë¡œ íŒì • ---
        const isClaimOk = stage.ok_claim_id === selectedClaimId;
        const isEvidenceOk = stage.ok_evidence_id === selectedEvidenceId;

        if (isClaimOk && isEvidenceOk) {
            handleSuccess();
        } else {
            handleFailure(stage);
        }
    }

    // ì„±ê³µ
    function handleSuccess() {
        currentStageIndex++;
        showResultModal(
            "ì„±ê³µ!",
            "ì •í™•í•œ ë°˜ë°•ì…ë‹ˆë‹¤! AIê°€ ë‹¤ìŒ ì£¼ì¥ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.",
            "ë‹¤ìŒ ìŠ¤í…Œì´ì§€",
            () => {
                resultModal.classList.add('hidden');
                loadStage(currentStageIndex);
                updateStatusUI();
            }
        );
    }

    // ì‹¤íŒ¨
    function handleFailure(stage) {
        mentalPower--;
        updateStatusUI();
        if (mentalPower <= 0) {
            gameInProgress = false;
            showResultModal("ê²Œì„ ì˜¤ë²„", "ì •ì‹ ë ¥ì´ 0ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. AIì˜ ì£¼ì¥ì— ë°€ë ¸ìŠµë‹ˆë‹¤.", "ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°", initGame);
        } else {
            // --- (ìˆ˜ì •) ë‹¨ì¼ ì •ë‹µìœ¼ë¡œ í”¼ë“œë°± ---
            const correctClaimId = stage.ok_claim_id;
            const correctEvidenceId = stage.ok_evidence_id;
            const correctClaimText = MASTER_CARDS[correctClaimId].text;
            const correctEvidenceText = MASTER_CARDS[correctEvidenceId].text;

            const feedback = `ì´ê²ƒì´ ì •ë‹µ ì¡°í•©ì…ë‹ˆë‹¤:\n\n[ì£¼ì¥]\n"${correctClaimText.trim()}"\n\n[ê·¼ê±°]\n"${correctEvidenceText.trim()}"`;

            showResultModal(
                "ì‹¤íŒ¨...",
                `ì •ì‹ ë ¥ì´ 1 ê°ì†Œí–ˆìŠµë‹ˆë‹¤. (ë‚¨ì€ ì •ì‹ ë ¥: ${mentalPower})\n\n${feedback}`,
                "ë‹¤ì‹œ ì‹œë„í•˜ê¸°",
                () => {
                    resultModal.classList.add('hidden');
                    resetStageUI();
                }
            );
        }
    }

    // --- 7. íŒíŠ¸ ë¡œì§ ---

    // íŒíŠ¸ ë²„íŠ¼ í´ë¦­
    function handleHint() {
        if (selectionPhase !== 'evidence' || hintsLeft <= 0 || hintActive || !gameInProgress) return;

        hintsLeft--;
        hintActive = true;
        hintButton.disabled = true;
        hintCount.textContent = hintsLeft;
        updateHintButtonState();

        const stage = currentStageSet[currentStageIndex];

        // --- (ìˆ˜ì •) ë‹¨ì¼ ì •ë‹µìœ¼ë¡œ íŒíŠ¸ í’€ êµ¬ì„± ---
        const okEvidenceInHand = currentHandCache.filter(id => stage.ok_evidence_id === id);
        const incorrectEvidenceInHand = currentHandCache.filter(id => stage.ok_evidence_id !== id);

        const correctHintCard = okEvidenceInHand[0]; // ë¬´ì¡°ê±´ ì •ë‹µ 1ê°œ
        const incorrectHintCard = shuffle(incorrectEvidenceInHand)[0]; // ì˜¤ë‹µ 1ê°œ

        hintPool = [correctHintCard, incorrectHintCard].filter(id => id); // [ì •ë‹µ, ì˜¤ë‹µ]

        renderPlayerHand(); // íŒíŠ¸ê°€ ì ìš©ëœ í•¸ë“œë¡œ ë‹¤ì‹œ ë Œë”ë§ (2ê°œë§Œ)

        showResultModal(
            "íŒíŠ¸ ì‚¬ìš©!",
            `ê·¼ê±° ì¹´ë“œì˜ í›„ë³´ë¥¼ ${hintPool.length}ê°œë¡œ ì¢í˜”ìŠµë‹ˆë‹¤.`,
            "í™•ì¸",
            () => resultModal.classList.add('hidden')
        );
    }

    // íŒíŠ¸ ì‚¬ìš© ì‹œ, ì˜¤ë‹µ ì¹´ë“œë¥¼ ë¹„í™œì„±í™”
    function disableWrongHintCard() {
        const wrongCardId = hintPool.find(id => id !== selectedEvidenceId);
        if (wrongCardId) {
            const wrongCardEl = document.getElementById(`card-${wrongCardId}`);
            if (wrongCardEl) {
                wrongCardEl.classList.add('disabled');
            }
        }
    }

    // íŒíŠ¸ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateHintButtonState() {
        const isHintAvailable = (hintsLeft > 0 && selectionPhase === 'evidence' && !hintActive);
        hintButton.disabled = !isHintAvailable;
        if (isHintAvailable) {
            hintButton.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            hintButton.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    // ê²Œì„ ì‹œì‘ ì‹œ íŒíŠ¸ ë²„íŠ¼ ë¦¬ì…‹
    function resetHintButton() {
        hintCount.textContent = hintsLeft;
        updateHintButtonState();
    }

    // --- 8. ìœ í‹¸ë¦¬í‹° (ëª¨ë‹¬) ---
    function showResultModal(title, message, buttonText, callback) {
        modalTitle.textContent = title;
        modalMessage.textContent = message;

        const newButton = modalButton.cloneNode(true);
        newButton.textContent = buttonText;
        modalButton.parentNode.replaceChild(newButton, modalButton);
        newButton.addEventListener('click', callback, { once: true });
        modalButton = newButton;

        resultModal.classList.remove('hidden');
        resultModal.classList.add('flex');
    }

    // --- 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    document.addEventListener('DOMContentLoaded', () => {
        startProButton.addEventListener('click', () => startGame('pro'));
        startConButton.addEventListener('click', () => startGame('con'));

        submitButton.addEventListener('click', handleSubmit);
        resetSelectionButton.addEventListener('click', resetStageUI);
        hintButton.addEventListener('click', handleHint);

        initGame(); // ì•± ì‹œì‘
    });

</script>
</body>
</html>

