<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>클릭클릭! 나의 작은 밭</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Gaegu', cursive;
      background-color: #f0e8d9; /* 따뜻한 배경색 */
      touch-action: manipulation; /* 모바일에서 더블탭 확대 방지 */
    }
    /* 드래그 및 선택 방지 */
    .game-container, .game-container * {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-user-drag: none;
    }
    .game-container {
      width: 100%; /* 화면 너비에 맞춤 */
      max-width: 600px; /* 최대 너비 600px로 설정 */
      height: 100vh;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      background-color: #7c9c60; /* 풀색 배경 */
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    .overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(91, 124, 67, 0.95);
      z-index: 100;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: opacity 0.5s ease;
    }
    .overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #plot-container {
      width: 256px;
      height: 256px;
      cursor: pointer;
      transition: transform 0.1s ease;
      position: relative;
    }
    #plot-container:active { transform: scale(0.97); }
    #plant-area {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 20;
      top: -60px;
    }
    .modal {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .modal.hidden {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }
    .seed-pack {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><path d="M10 0 H90 L100 10 V110 L90 120 H10 L0 110 V10 Z" fill="%23d2b48c" stroke="%238b5e34" stroke-width="2"/><path d="M20 10 H80 V100 H20Z" fill="%23f5deb3" stroke="%238b5e34" stroke-width="1"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    .click-feedback {
      position: absolute;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fbbf24;
      animation: pop 0.5s ease-out forwards;
      pointer-events: none;
      text-shadow: 1px 1px 2px black;
    }
    @keyframes sparkle {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.5; }
    }
    .sparkle-effect {
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 15 L 53 28 L 65 30 L 53 32 L 50 45 L 47 32 L 35 30 L 47 28 Z' fill='%23fef08a'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 50% 25%;
      background-size: 30%;
      animation: sparkle 1.5s infinite;
      pointer-events: none;
    }

    #toast-message {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translate(-50%, 20px);
      background-color: rgba(0, 0, 0, 0.75);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.4s ease, transform 0.4s ease;
      pointer-events: none;
      font-size: 1.1rem;
      font-weight: bold;
      white-space: nowrap;
    }
    #toast-message.show {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    .tab-btn.active {
      background-color: #a3b18a;
      color: white;
    }
  </style>
</head>
<body class="bg-[#f0e8d9]">

<div id="game-container" class="game-container">

  <div id="main-game-content" class="flex flex-col h-full">
    <!-- 상단 UI: 재화 -->
    <header class="p-4 flex justify-end items-center space-x-2 bg-[#a3b18a] rounded-b-lg shadow-md z-40">
      <img src="https://unluckyidiot16.github.io/assets-common/MyTinyPlants/Particle_Coin.png" class="w-8 h-8">
      <span id="gold-display" class="text-3xl font-bold text-white text-shadow-lg">0</span>
    </header>

    <!-- 메인 게임 영역: 밭 -->
    <main class="flex-grow flex flex-col justify-center items-center relative z-[5]" id="click-area">
      <div class="absolute top-2 w-full px-4 z-40">
        <div class="w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 shadow-inner">
          <div id="growth-bar" class="bg-gradient-to-r from-yellow-400 to-green-500 h-4 rounded-full" style="width: 0%; transition: width 0.2s ease-in-out;"></div>
        </div>
        <div id="growth-text" class="text-center text-white font-bold text-lg mt-1"></div>
      </div>

      <div id="plot-container">
        <img src="https://unluckyidiot16.github.io/assets-common/MyTinyPlants/TileSet1.png" class="absolute w-full h-full z-10">
        <div id="plant-area" class="flex justify-center items-center"></div>
        <img src="https://unluckyidiot16.github.io/assets-common/MyTinyPlants/TileSet5.png" class="absolute w-full h-full z-30 pointer-events-none">
      </div>

      <div id="plot-message" class="text-center text-white text-2xl font-bold mt-4 p-2 bg-black bg-opacity-30 rounded-lg"></div>
    </main>

    <!-- 하단 메뉴 -->
    <footer class="grid grid-cols-3 gap-2 p-2 bg-[#a3b18a] rounded-t-lg shadow-inner z-40">
      <button id="seed-bag-btn" class="p-3 bg-[#dad7cd] rounded-lg shadow-md hover:bg-[#c9c4b5] transition active:scale-95">
        <svg class="w-10 h-10 mx-auto text-[#588157]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
        <span class="text-sm font-bold text-[#3a5a40]">씨앗</span>
      </button>
      <button id="shop-btn" class="p-3 bg-[#dad7cd] rounded-lg shadow-md hover:bg-[#c9c4b5] transition active:scale-95">
        <svg class="w-10 h-10 mx-auto text-[#588157]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
        <span class="text-sm font-bold text-[#3a5a40]">상점</span>
      </button>
      <button id="collection-btn" class="p-3 bg-[#dad7cd] rounded-lg shadow-md hover:bg-[#c9c4b5] transition active:scale-95">
        <svg class="w-10 h-10 mx-auto text-[#588157]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
        <span class="text-sm font-bold text-[#3a5a40]">도감</span>
      </button>
    </footer>
  </div>

  <!-- 모달들 -->
  <div id="seed-bag-modal" class="modal hidden absolute inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
    <div class="bg-[#f0e8d9] rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
      <h2 class="text-3xl font-bold text-[#3a5a40] mb-4">씨앗 주머니</h2>
      <div id="seed-list" class="grid grid-cols-3 gap-4 h-64 overflow-y-auto no-scrollbar"></div>
      <button id="close-seed-bag" class="mt-6 w-full bg-[#a3b18a] text-white font-bold py-3 rounded-lg shadow-md hover:bg-[#9cb083] transition active:scale-95">닫기</button>
    </div>
  </div>
  <div id="shop-modal" class="modal hidden absolute inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
    <div class="bg-[#f0e8d9] rounded-lg shadow-xl p-6 w-full max-w-md text-center">
      <div class="flex mb-4 border-b-2 border-[#a3b18a]">
        <button id="tab-gacha" class="tab-btn flex-1 p-3 font-bold text-xl text-gray-500 transition">씨앗 뽑기</button>
        <button id="tab-upgrades" class="tab-btn flex-1 p-3 font-bold text-xl text-gray-500 transition">업그레이드</button>
      </div>
      <div id="gacha-panel">
        <h2 class="text-3xl font-bold text-[#3a5a40] mb-4">씨앗 상점</h2>
        <div id="gacha-result" class="h-48 flex justify-center items-center my-4"><div class="w-40 h-48 seed-pack flex justify-center items-center"><span class="text-5xl font-bold text-yellow-500 opacity-80">?</span></div></div>
        <button id="gacha-btn" class="w-full bg-yellow-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-yellow-600 transition active:scale-95 text-xl"></button>
      </div>
      <div id="upgrades-panel" class="hidden">
        <h2 class="text-3xl font-bold text-[#3a5a40] mb-4">성장 연구소</h2>
        <div class="space-y-4">
          <div class="bg-[#dad7cd] p-4 rounded-lg flex items-center">
            <img src="https://unluckyidiot16.github.io/assets-common/MyTinyPlants/Tools6.png" class="w-16 h-16 mr-4">
            <div class="flex-grow text-left">
              <h3 class="text-2xl font-bold text-[#3a5a40]">물뿌리개 강화</h3>
              <p id="watering-can-desc" class="text-md my-1"></p>
              <button id="upgrade-watering-can-btn" class="w-full bg-blue-500 text-white font-bold py-2 rounded-lg shadow-md hover:bg-blue-600 transition disabled:bg-gray-400"></button>
            </div>
          </div>
          <div class="bg-[#dad7cd] p-4 rounded-lg flex items-center">
            <img src="https://unluckyidiot16.github.io/assets-common/MyTinyPlants/Tool3.png" class="w-16 h-16 mr-4">
            <div class="flex-grow text-left">
              <h3 class="text-2xl font-bold text-[#3a5a40]">비료 개발</h3>
              <p id="fertilizer-desc" class="text-md my-1"></p>
              <button id="upgrade-fertilizer-btn" class="w-full bg-green-500 text-white font-bold py-2 rounded-lg shadow-md hover:bg-green-600 transition disabled:bg-gray-400"></button>
            </div>
          </div>
        </div>
      </div>
      <button id="close-shop" class="mt-6 w-full bg-[#a3b18a] text-white font-bold py-3 rounded-lg shadow-md hover:bg-[#9cb083] transition active:scale-95">나가기</button>
    </div>
  </div>
  <div id="collection-modal" class="modal hidden absolute inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
    <div class="bg-[#f0e8d9] rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
      <h2 class="text-3xl font-bold text-[#3a5a40] mb-4">나의 작물 도감</h2>
      <div id="collection-list" class="grid grid-cols-3 gap-4 h-80 overflow-y-auto no-scrollbar p-2 bg-[#dad7cd] rounded-lg"></div>
      <button id="close-collection" class="mt-6 w-full bg-[#a3b18a] text-white font-bold py-3 rounded-lg shadow-md hover:bg-[#9cb083] transition active:scale-95">닫기</button>
    </div>
  </div>
  <div id="collection-detail-modal" class="modal hidden absolute inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[60] p-4">
    <div class="bg-[#f0e8d9] rounded-lg shadow-xl p-6 w-full max-w-sm text-center flex flex-col items-center">
      <div id="detail-plant-image" class="w-32 h-32 mb-4"></div>
      <h2 id="detail-plant-name" class="text-3xl font-bold text-[#3a5a40]"></h2>
      <div class="my-4 text-left w-full">
        <p class="text-lg"><span class="font-bold">희귀도:</span> <span id="detail-plant-rarity"></span></p>
        <p class="text-lg"><span class="font-bold">판매가:</span> <span id="detail-plant-price"></span> G</p>
        <p id="detail-plant-desc" class="mt-2 text-md bg-[#dad7cd] p-3 rounded-lg"></p>
      </div>
      <button id="close-collection-detail" class="mt-4 w-full bg-[#a3b18a] text-white font-bold py-3 rounded-lg shadow-md hover:bg-[#9cb083] transition active:scale-95">닫기</button>
    </div>
  </div>

  <!-- 타이틀 화면 -->
  <div id="title-screen" class="overlay">
    <h1 class="text-6xl font-bold text-white mb-4 text-center">클릭클릭!<br>나의 작은 밭</h1>
    <p class="text-white text-xl mb-8">아기자기한 밭을 꾸며보세요!</p>
    <button id="start-game-btn" class="bg-yellow-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg text-2xl hover:bg-yellow-600 transition active:scale-95">게임 시작</button>
  </div>

  <!-- 클리어 화면 -->
  <div id="clear-screen" class="overlay hidden">
    <h1 class="text-6xl font-bold text-white mb-4 text-center">Congratulations!</h1>
    <p class="text-white text-2xl mb-8">모든 작물을 수집했어요!</p>
    <div class="w-48 h-48 my-4" id="clear-image"></div>
    <button id="restart-game-btn" class="bg-red-500 text-white font-bold py-4 px-8 rounded-lg shadow-lg text-2xl hover:bg-red-600 transition active:scale-95">다시 시작하기</button>
  </div>

  <div id="toast-message" class=""></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const IMAGE_ROOT = 'https://unluckyidiot16.github.io/assets-common/MyTinyPlants/';
    const GACHA_COST = 20;
    const WATERING_CAN_COSTS = [200, 500, 1200, 3000];
    const FERTILIZER_COSTS = [50, 150, 400, 1000, 2500];

    // All DOM elements are correctly selected here...
    const goldDisplay = document.getElementById('gold-display');
    const plantArea = document.getElementById('plant-area');
    const growthBar = document.getElementById('growth-bar');
    const growthText = document.getElementById('growth-text');
    const plotMessage = document.getElementById('plot-message');
    const plotContainer = document.getElementById('plot-container');
    const toastMessage = document.getElementById('toast-message');
    let toastTimeout;
    let gameInterval;
    const modals = { seedBag: document.getElementById('seed-bag-modal'), shop: document.getElementById('shop-modal'), collection: document.getElementById('collection-modal'), collectionDetail: document.getElementById('collection-detail-modal'),};
    const buttons = { openSeedBag: document.getElementById('seed-bag-btn'), openShop: document.getElementById('shop-btn'), openCollection: document.getElementById('collection-btn'), closeSeedBag: document.getElementById('close-seed-bag'), closeShop: document.getElementById('close-shop'), closeCollection: document.getElementById('close-collection'), closeCollectionDetail: document.getElementById('close-collection-detail'), gacha: document.getElementById('gacha-btn'), upgradeWateringCan: document.getElementById('upgrade-watering-can-btn'), upgradeFertilizer: document.getElementById('upgrade-fertilizer-btn'), startGame: document.getElementById('start-game-btn'), restartGame: document.getElementById('restart-game-btn'),};
    const seedList = document.getElementById('seed-list');
    const collectionList = document.getElementById('collection-list');
    const gachaResult = document.getElementById('gacha-result');
    const tabGacha = document.getElementById('tab-gacha');
    const tabUpgrades = document.getElementById('tab-upgrades');
    const gachaPanel = document.getElementById('gacha-panel');
    const upgradesPanel = document.getElementById('upgrades-panel');
    const titleScreen = document.getElementById('title-screen');
    const clearScreen = document.getElementById('clear-screen');

    const PLANT_DATA = {
      chili: { name: "고추", rarity: "보통", sellPrice: 20, clicksToGrow: [10, 20, 40, 80, 100], imageFiles: ['Chili1.png', 'Chili2.png', 'Chili3.png', 'Chili4.png', 'Chili5.png'], seedImage: 'ChiliSeed.png', description: "작지만 매운 맛이 일품인 붉은 보석이에요!" },
      carrot: { name: "당근", rarity: "보통", sellPrice: 25, clicksToGrow: [12, 25, 45, 90, 110], imageFiles: ['Carrot1.png', 'Carrot2.png', 'Carrot3.png', 'Carrot4.png', 'Carrot5.png'], seedImage: 'CarrotSeed.png', description: "달콤하고 아삭아삭! 흙 속의 비타민 왕!" },
      onion: { name: "양파", rarity: "보통", sellPrice: 30, clicksToGrow: [15, 30, 50, 100, 120], imageFiles: ['Onion1.png', 'Onion2.png', 'Onion3.png', 'Onion4.png', 'Onion5.png'], seedImage: 'OnionSeed.png', description: "까면 깔수록 새로운 매력이! 요리의 감초랍니다." },
      leek: { name: "대파", rarity: "보통", sellPrice: 28, clicksToGrow: [14, 28, 48, 95, 115], imageFiles: ['Leek1.png', 'Leek2.png', 'Leek3.png', 'Leek4.png', 'Leek5.png'], seedImage: 'LeekSeed.png', description: "어떤 요리에도 잘 어울리는 향긋한 초록색 기둥!" },
      radish: { name: "무", rarity: "보통", sellPrice: 32, clicksToGrow: [18, 32, 55, 105, 125], imageFiles: ['Radish1.png', 'Radish2.png', 'Radish3.png', 'Radish4.png', 'Radish5.png'], seedImage: 'RadishSeed.png', description: "아삭하고 시원한 맛! 김치의 단짝 친구랍니다." },
      tomato: { name: "토마토", rarity: "보통", sellPrice: 35, clicksToGrow: [20, 35, 60, 110, 130], imageFiles: ['Tomato1.png', 'Tomato2.png', 'Tomato3.png', 'Tomato4.png', 'Tomato5.png'], seedImage: 'TomatoSeed.png', description: "과일일까? 채소일까? 정답은 '맛있다'!" },
      pea: { name: "완두콩", rarity: "희귀", sellPrice: 80, clicksToGrow: [25, 40, 70, 120, 150], imageFiles: ['Pea1.png', 'Pea2.png', 'Pea3.png', 'Pea4.png', 'Pea5.png'], seedImage: 'PeaSeed.png', description: "작은 콩깍지 안에 초록색 보물들이 숨어있어요." }
    };

    let gameState = {
      gold: 50, currentPlant: null, ownedSeeds: { chili: 1 }, collection: [],
      upgrades: { wateringCan: 1, fertilizer: 0 }
    };

    // All functions are declared here before being called
    function saveData() { localStorage.setItem('farmClickerData', JSON.stringify(gameState)); }
    function loadData() { const d = localStorage.getItem('farmClickerData'); if(d){ gameState = JSON.parse(d); if(!gameState.upgrades) gameState.upgrades = {wateringCan:1, fertilizer:0}; } }
    function updateUI() { /* Function implementation */ }
    function updateUpgradeUI() { /* Function implementation */ }
    function handlePlotClick(e) { /* Function implementation */ }
    function createClickFeedback(e) { /* Function implementation */ }
    function plantSeed(plantId) { /* Function implementation */ }
    function showToast(message) { /* Function implementation */ }
    function handleGacha() { /* Function implementation */ }
    function getPlantDisplayHtml(plantId, sizeClass = 'w-16 h-16', forSeed = true) { /* Function implementation */ }
    function updateSeedBagUI() { /* Function implementation */ }
    function updateCollectionUI() { /* Function implementation */ }
    function showCollectionDetail(plantId) { /* Function implementation */ }
    function toggleModal(modalName, show) { /* Function implementation */ }
    function checkGameClear() { /* Function implementation */ }

    function attachEventListeners() {
      buttons.openSeedBag.onclick = () => toggleModal('seedBag', true);
      buttons.closeSeedBag.onclick = () => toggleModal('seedBag', false);
      buttons.openShop.onclick = () => { toggleModal('shop', true); tabGacha.click(); };
      buttons.closeShop.onclick = () => toggleModal('shop', false);
      buttons.openCollection.onclick = () => toggleModal('collection', true);
      buttons.closeCollection.onclick = () => toggleModal('collection', false);
      buttons.closeCollectionDetail.onclick = () => toggleModal('collectionDetail', false);
      buttons.gacha.onclick = handleGacha;
      plotContainer.addEventListener('click', handlePlotClick);
      buttons.upgradeWateringCan.onclick = () => { const l=gameState.upgrades.wateringCan; if(l<5){const c=WATERING_CAN_COSTS[l-1]; if(gameState.gold>=c){gameState.gold-=c; gameState.upgrades.wateringCan++; updateUI();}}};
      buttons.upgradeFertilizer.onclick = () => { const l=gameState.upgrades.fertilizer; if(l<5){const c=FERTILIZER_COSTS[l]; if(gameState.gold>=c){gameState.gold-=c; gameState.upgrades.fertilizer++; updateUI();}}};
      tabGacha.onclick = () => { tabGacha.classList.add('active'); tabUpgrades.classList.remove('active'); gachaPanel.classList.remove('hidden'); upgradesPanel.classList.add('hidden'); };
      tabUpgrades.onclick = () => { tabUpgrades.classList.add('active'); tabGacha.classList.remove('active'); upgradesPanel.classList.remove('hidden'); gachaPanel.classList.add('hidden'); };
    }

    buttons.startGame.onclick = () => {
      titleScreen.classList.add('hidden');
      initGame();
    };

    buttons.restartGame.onclick = () => {
      localStorage.removeItem('farmClickerData');
      window.location.reload();
    };

    function initGame() {
      attachEventListeners();
      loadData();
      if (!localStorage.getItem('farmClickerData')) {
        gameState = { gold: 50, currentPlant: null, ownedSeeds: { chili: 1 }, collection: [], upgrades: { wateringCan: 1, fertilizer: 0 } };
      }
      if (Object.keys(PLANT_DATA).length === gameState.collection.length) {
        document.getElementById('clear-image').innerHTML = getPlantDisplayHtml('pea', 'w-full h-full', false);
        clearScreen.classList.remove('hidden');
        return;
      }
      updateUI();
      gameInterval = setInterval(() => {
        if (gameState.currentPlant && gameState.upgrades.fertilizer > 0) {
          const plantData = PLANT_DATA[gameState.currentPlant.id];
          const currentStage = gameState.currentPlant.stage;
          if (currentStage < plantData.clicksToGrow.length - 1) {
            gameState.currentPlant.clicks += gameState.upgrades.fertilizer;
            if (gameState.currentPlant.clicks >= plantData.clicksToGrow[currentStage]) {
              gameState.currentPlant.stage++;
              gameState.currentPlant.clicks = 0;
            }
            updateUI();
          }
        }
      }, 1000);
    }

    // --- Full function definitions ---
    updateUI = function() { goldDisplay.textContent = gameState.gold; buttons.gacha.textContent = `씨앗 뽑기 (${GACHA_COST} G)`; if (gameState.currentPlant) { const plant = PLANT_DATA[gameState.currentPlant.id]; const stage = gameState.currentPlant.stage; const clicks = gameState.currentPlant.clicks; const clicksNeeded = plant.clicksToGrow[stage]; plantArea.innerHTML = `<img src="${IMAGE_ROOT}${plant.imageFiles[stage]}" class="max-w-full max-h-full object-contain">`; const isHarvestable = stage >= plant.clicksToGrow.length - 1; if (isHarvestable) { growthBar.style.width = '100%'; growthText.textContent = `${plant.name} 수확 가능!`; plotMessage.textContent = '탭해서 수확하기'; if (!plantArea.querySelector('.sparkle-effect')) { const sparkle = document.createElement('div'); sparkle.className = 'sparkle-effect'; plantArea.appendChild(sparkle); } } else { const progress = (clicks / clicksNeeded) * 100; growthBar.style.width = `${progress}%`; growthText.textContent = `${plant.name} 성장중... (${Math.floor(clicks)}/${clicksNeeded})`; plotMessage.textContent = ''; } } else { plantArea.innerHTML = ''; growthBar.style.width = '0%'; growthText.textContent = '씨앗을 심어주세요!'; plotMessage.textContent = '씨앗 주머니를 확인하세요'; } updateSeedBagUI(); updateCollectionUI(); updateUpgradeUI(); saveData(); };
    updateUpgradeUI = function() { const wcLevel = gameState.upgrades.wateringCan; const fLevel = gameState.upgrades.fertilizer; document.getElementById('watering-can-desc').textContent = `현재 레벨: ${wcLevel} (탭 당 +${wcLevel})`; if (wcLevel < 5) { const cost = WATERING_CAN_COSTS[wcLevel - 1]; buttons.upgradeWateringCan.textContent = `Lv.${wcLevel + 1}로 업그레이드 (${cost} G)`; buttons.upgradeWateringCan.disabled = gameState.gold < cost; } else { buttons.upgradeWateringCan.textContent = '최고 레벨'; buttons.upgradeWateringCan.disabled = true; } document.getElementById('fertilizer-desc').textContent = `현재 레벨: ${fLevel} (초 당 +${fLevel})`; if (fLevel < 5) { const cost = FERTILIZER_COSTS[fLevel]; buttons.upgradeFertilizer.textContent = `Lv.${fLevel + 1}로 업그레이드 (${cost} G)`; buttons.upgradeFertilizer.disabled = gameState.gold < cost; } else { buttons.upgradeFertilizer.textContent = '최고 레벨'; buttons.upgradeFertilizer.disabled = true; } };
    handlePlotClick = function(e) { if (!gameState.currentPlant) return; const plantData = PLANT_DATA[gameState.currentPlant.id]; const currentStage = gameState.currentPlant.stage; if (currentStage >= plantData.clicksToGrow.length - 1) { gameState.gold += plantData.sellPrice; plotMessage.textContent = `+${plantData.sellPrice} G`; gameState.currentPlant = null; setTimeout(() => plotMessage.textContent = '', 1000); updateUI(); return; } createClickFeedback(e); gameState.currentPlant.clicks += gameState.upgrades.wateringCan; if (gameState.currentPlant.clicks >= plantData.clicksToGrow[currentStage]) { gameState.currentPlant.stage++; gameState.currentPlant.clicks = 0; } updateUI(); };
    createClickFeedback = function(e) { const feedback = document.createElement('div'); feedback.classList.add('click-feedback'); feedback.textContent = `+${gameState.upgrades.wateringCan}`; const rect = document.getElementById('click-area').getBoundingClientRect(); feedback.style.left = `${e.clientX - rect.left}px`; feedback.style.top = `${e.clientY - rect.top}px`; document.getElementById('click-area').appendChild(feedback); setTimeout(() => feedback.remove(), 500); };
    plantSeed = function(plantId) { if (gameState.currentPlant || !gameState.ownedSeeds[plantId] || gameState.ownedSeeds[plantId] <= 0) return; if (!gameState.collection.includes(plantId)) { gameState.collection.push(plantId); showToast(`'${PLANT_DATA[plantId].name}'이(가) 도감에 등록되었어요!`); checkGameClear(); } gameState.ownedSeeds[plantId]--; gameState.currentPlant = { id: plantId, stage: 0, clicks: 0 }; toggleModal('seedBag', false); updateUI(); };
    showToast = function(message) { clearTimeout(toastTimeout); toastMessage.textContent = message; toastMessage.classList.add('show'); toastTimeout = setTimeout(() => { toastMessage.classList.remove('show'); }, 3000); };
    handleGacha = function() { if (gameState.gold < GACHA_COST) { alert(`골드가 부족합니다! (${GACHA_COST} G 필요)`); return; } gameState.gold -= GACHA_COST; const rarities = { common: 0.8, rare: 0.2 }; const plantsByRarity = { common: [], rare: [] }; Object.keys(PLANT_DATA).forEach(id => { const rKey = PLANT_DATA[id].rarity === '희귀' ? 'rare' : 'common'; if(plantsByRarity[rKey]) plantsByRarity[rKey].push(id); }); let cRarity = Math.random() < rarities.common ? 'common' : 'rare'; if (!plantsByRarity[cRarity]?.length) cRarity = 'common'; const cPool = plantsByRarity[cRarity]; const cPlantId = cPool[Math.floor(Math.random() * cPool.length)]; if (!gameState.ownedSeeds[cPlantId]) gameState.ownedSeeds[cPlantId] = 0; gameState.ownedSeeds[cPlantId]++; if (!gameState.collection.includes(cPlantId)) { gameState.collection.push(cPlantId); showToast(`'${PLANT_DATA[cPlantId].name}'이(가) 도감에 등록되었어요!`); checkGameClear(); } gachaResult.innerHTML = `<div class="flex flex-col items-center animate-pulse">${getPlantDisplayHtml(cPlantId, 'w-24 h-24')}<p class="font-bold text-xl">${PLANT_DATA[cPlantId].name} 씨앗 획득!</p></div>`; updateUI(); };
    getPlantDisplayHtml = function(plantId, sizeClass = 'w-16 h-16', forSeed = true) { const pData = PLANT_DATA[plantId]; const useSeed = forSeed && pData.seedImage; if (useSeed) return `<img src="${IMAGE_ROOT}${pData.seedImage}" class="${sizeClass} object-contain">`; const fIndex = pData.imageFiles.length - 1; return `<img src="${IMAGE_ROOT}${pData.imageFiles[fIndex]}" class="${sizeClass} object-contain">`; };
    updateSeedBagUI = function() { seedList.innerHTML = ''; const owned = Object.keys(gameState.ownedSeeds).filter(id => gameState.ownedSeeds[id] > 0); if (owned.length === 0) { seedList.innerHTML = `<p class="col-span-3 text-gray-500">씨앗이 없습니다. 상점에서 뽑아보세요!</p>`; } else { owned.forEach(pId => { const el = document.createElement('div'); el.className = 'flex flex-col items-center cursor-pointer p-2 rounded-lg hover:bg-yellow-100'; el.innerHTML = `${getPlantDisplayHtml(pId)}<span class="font-bold">${PLANT_DATA[pId].name}</span><span class="text-sm">x${gameState.ownedSeeds[pId]}</span>`; el.onclick = () => plantSeed(pId); seedList.appendChild(el); }); } };
    updateCollectionUI = function() { collectionList.innerHTML = ''; Object.keys(PLANT_DATA).forEach(pId => { const item = document.createElement('div'); item.className = 'flex flex-col items-center p-2 rounded-lg bg-white shadow-md'; const isDiscovered = gameState.collection.includes(pId); if (isDiscovered) { item.innerHTML = `${getPlantDisplayHtml(pId)}<span class="font-bold text-sm">${PLANT_DATA[pId].name}</span>`; item.classList.add('cursor-pointer'); item.onclick = () => showCollectionDetail(pId); } else { item.innerHTML = `<div class="w-16 h-16 flex items-center justify-center text-gray-400 text-4xl font-bold">?</div><span class="font-bold text-sm text-gray-400">미발견</span>`; } collectionList.appendChild(item); }); };
    showCollectionDetail = function(plantId) { const pData = PLANT_DATA[plantId]; document.getElementById('detail-plant-image').innerHTML = getPlantDisplayHtml(plantId, 'w-full h-full', false); document.getElementById('detail-plant-name').textContent = pData.name; document.getElementById('detail-plant-rarity').textContent = pData.rarity; document.getElementById('detail-plant-price').textContent = pData.sellPrice; document.getElementById('detail-plant-desc').textContent = pData.description; toggleModal('collectionDetail', true); };
    toggleModal = function(modalName, show) { if (show) modals[modalName].classList.remove('hidden'); else { modals[modalName].classList.add('hidden'); if (modalName === 'shop') { setTimeout(() => { gachaResult.innerHTML = `<div class="w-40 h-48 seed-pack flex justify-center items-center"><span class="text-5xl font-bold text-yellow-500 opacity-80">?</span></div>`; }, 300); } } };
    checkGameClear = function() { if (Object.keys(PLANT_DATA).length === gameState.collection.length) { clearInterval(gameInterval); document.getElementById('clear-image').innerHTML = getPlantDisplayHtml('pea', 'w-full h-full', false); clearScreen.classList.remove('hidden'); } };

  });
</script>
</body>
</html>

